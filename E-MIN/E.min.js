E={};
window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(c){return window.setTimeout(c,1E3/60)}}();(function(c){var b=function(){this.posy=this.posx=0;this.keys={};this.keyEvents={};this.mouseEvents={};this.LEFTMB=1;this.RIGHTMB=3;this.MIDDLEMB=2};b.prototype.mouseup=function(a){if(a.which==c.controls.LEFTMB)c.controls.leftmbstate=!1;else if(a.which==c.controls.RIGHTMB)c.controls.rightmbstate=!1,a.preventDefault();else if(a.which==c.controls.MIDDLEMB)c.controls.middlembstate=!1;console.log("mouseup",a.which)};b.prototype.mousedown=function(a){if(a.which==c.controls.LEFTMB)c.controls.leftmbstate=
!0;else if(a.which==c.controls.RIGHTMB)c.controls.rightmbstate=!0,a.preventDefault();else if(a.which==c.controls.MIDDLEMB)c.controls.middlembstate=!0;if(typeof c.controls.mouseEvents[a.which]==="function")c.controls.mouseEvents[a.which]();console.log("mousedown",a.which)};b.prototype.mousemove=function(a){var b,f;if(a.pageX||a.pageY)b=a.pageX,f=a.pageY;else if(a.clientX||a.clientY)b=a.clientX+document.body.scrollLeft+document.documentElement.scrollLeft,f=a.clientY+document.body.scrollTop+document.documentElement.scrollTop;
c.controls.posx=b-c.game.offset.left;c.controls.posy=f-c.game.offset.top};b.prototype.keydown=function(a){var b;if(!a)a=window.event;if(a.keyCode)b=a.keyCode;else if(a.which)b=a.which;c.controls.keys[b]=!0;if(typeof c.controls.keyEvents[b]==="function")c.controls.keyEvents[b]();console.log("keydown",a.which)};b.prototype.keyup=function(a){var b;if(!a)a=window.event;if(a.keyCode)b=a.keyCode;else if(a.which)b=a.which;c.controls.keys[b]=!1;console.log("keyup",a.which)};b.prototype.removeMouseListener=
function(a){this.mouseEvents[a]=void 0};b.prototype.addMouseListener=function(a,b){this.mouseEvents[a]=b};b.prototype.removeKeyListener=function(a){this.keyEvents[a]=void 0};b.prototype.addKeyListener=function(a,b){this.keyEvents[a]=b};b.prototype.getKeyState=function(a){return this.keys[a||1]};b.prototype.init=function(){$canvas=$("#canvas");$document=$(document);console.log("controls done",$canvas);$canvas.bind("mousemove",this.mousemove);$document.keydown(this.keydown);$document.keyup(this.keyup);
$canvas.bind("mousedown",this.mousedown);$canvas.bind("mouseup",this.mouseup)};b.prototype.getMouseX=function(){return this.posx};b.prototype.getMouseY=function(){return this.posy};b.prototype.getMouseLeft=function(){return this.leftmbstate};c.controls=new b})(E);
E.game=function(){function c(){j.clearRect(0,0,f,h);for(var b=(new Date).getTime()-k,l=d.length,e=0;e<l;e++)if(d[e])typeof d[e].move==="function"&&d[e].move(b)==!1?d[e].move=void 0:d[e].paint(j);if(g%500==0){l=m.length;for(e=0;e<l;e++)d.splice(m[e],1);m=[]}typeof i==="function"&&i();E.game.frame++;k=(new Date).getTime();requestAnimFrame(c,a)}var b,a,j,f,h,g=0,i,d=[],m=[],k;return{init:function(d,g,e){$element=$(d);f=this.width=$element.innerWidth();h=this.height=$element.innerHeight();d=$('<canvas  id="canvas"></canvas>');
d.attr("height",this.height);d.attr("width",this.width);$element.append(d);b=$("#canvas");b.attr("oncontextmenu","return false;");$element.css("overflow","hidden");console.log(this.height,this.width);this.offset=b.offset();a=b[0];j=a.getContext("2d");k=(new Date).getTime();this.frame=0;i=e;typeof g==="function"&&g();E.controls.init();console.log("init Done",j);c()},add:function(a){d.push(a)},start:c,objects:d,height:h,width:f,frame:g,offset:void 0}}();
(function(c){c.shapes={rect:function(b,a,c,f,h,g){this.y=f;this.x=c;this.width=b;this.height=a;this.colour=h;this.move=g||void 0;this.paint=function(a){a.fillStyle=this.colour;a.fillRect(this.x,this.y,this.height,this.width)}},circle:function(b,a,c,f,h,g){this.y=c;this.x=a;this.diam=b;this.colour=f;this.move=h;this.paint=function(a){a.fillStyle=this.colour;a.beginPath();a.arc(this.x,this.y,this.diam,0,Math.PI*2,!0);a.closePath();a.fill()};for(var i in g)this[i]=g[i]},line:function(){}}})(E);
(function(c){var b=function(a,b){this.x=a;this.y=b};b.prototype.add=function(a){this.x+=a.x;this.y+=a.y};b.prototype.del=function(a){this.x-=a.x;this.y-=a.y};b.prototype.norm=function(){var a=this.mag;this.x/=a;this.y/=a};b.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y)};c.vector=b})(E);
